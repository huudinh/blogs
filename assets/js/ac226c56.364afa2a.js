"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[5092],{8254:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"nextjs/basic/api-routes","title":"API Routes","description":"API Routes trong Next.js l\xe0 c\xe1ch \u0111\u1ec3 b\u1ea1n x\xe2y d\u1ef1ng API backend ngay b\xean trong \u1ee9ng d\u1ee5ng Next.js m\xe0 kh\xf4ng c\u1ea7n server ri\xeang. N\xf3 cho ph\xe9p b\u1ea1n vi\u1ebft c\xe1c endpoint (RESTful ho\u1eb7c custom) tr\u1ef1c ti\u1ebfp trong th\u01b0 m\u1ee5c pages/api/.","source":"@site/docs/nextjs/basic/012-api-routes.md","sourceDirName":"nextjs/basic","slug":"/nextjs/basic/api-routes","permalink":"/blogs/docs/nextjs/basic/api-routes","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"nextjsSidebar","previous":{"title":"Dynamic Routes","permalink":"/blogs/docs/nextjs/basic/dynamic-routes"}}');var r=e(4848),i=e(8453);const o={sidebar_position:12},d="API Routes",a={},c=[{value:"I. RESTful API l\xe0 g\xec?",id:"i-restful-api-l\xe0-g\xec",level:2},{value:"II. T\u1ea1i sao RESTful API quan tr\u1ecdng?",id:"ii-t\u1ea1i-sao-restful-api-quan-tr\u1ecdng",level:2},{value:"III. \xc1p d\u1ee5ng RESTful API trong Next.js",id:"iii-\xe1p-d\u1ee5ng-restful-api-trong-nextjs",level:2},{value:"IV. V\xed d\u1ee5 RESTful API chu\u1ea9n trong Next.js",id:"iv-v\xed-d\u1ee5-restful-api-chu\u1ea9n-trong-nextjs",level:2},{value:"1. GET all posts \u2192 /api/posts",id:"1-get-all-posts--apiposts",level:4},{value:"2. POST create new post \u2192 /api/posts",id:"2-post-create-new-post--apiposts",level:4},{value:"3. GET, PUT, DELETE by ID \u2192 /api/posts/[id]",id:"3-get-put-delete-by-id--apipostsid",level:4},{value:"4. Quy t\u1eafc \u0111\u1ec3 g\u1ecdi l\xe0 RESTful API chu\u1ea9n",id:"4-quy-t\u1eafc-\u0111\u1ec3-g\u1ecdi-l\xe0-restful-api-chu\u1ea9n",level:4},{value:"\u2713 D\xf9ng HTTP method \u0111\xfang ngh\u0129a",id:"-d\xf9ng-http-method-\u0111\xfang-ngh\u0129a",level:4},{value:"\u2713 Tr\u1ea3 JSON \u0111\xfang format",id:"-tr\u1ea3-json-\u0111\xfang-format",level:4},{value:"\u2713 Stateless (kh\xf4ng l\u01b0u tr\u1ea1ng th\xe1i)",id:"-stateless-kh\xf4ng-l\u01b0u-tr\u1ea1ng-th\xe1i",level:4},{value:"V. RESTful API so v\u1edbi API Routes c\u0169",id:"v-restful-api-so-v\u1edbi-api-routes-c\u0169",level:2},{value:"IX. Th\u1ef1c h\xe0nh",id:"ix-th\u1ef1c-h\xe0nh",level:2},{value:"1. C\u1ea5u tr\xfac th\u01b0 m\u1ee5c chu\u1ea9n",id:"1-c\u1ea5u-tr\xfac-th\u01b0-m\u1ee5c-chu\u1ea9n",level:3},{value:"2. T\u1ea1o file JSON (data/posts.json)",id:"2-t\u1ea1o-file-json-datapostsjson",level:3},{value:"3. GET t\u1ea5t c\u1ea3 + t\u1ea1o m\u1edbi",id:"3-get-t\u1ea5t-c\u1ea3--t\u1ea1o-m\u1edbi",level:3},{value:"4. GET 1 post \u2013 UPDATE \u2013 DELETE",id:"4-get-1-post--update--delete",level:3},{value:"5. C\xe1ch g\u1ecdi API t\u1eeb component (Server ho\u1eb7c Client)",id:"5-c\xe1ch-g\u1ecdi-api-t\u1eeb-component-server-ho\u1eb7c-client",level:3},{value:"L\u1ea5y to\xe0n b\u1ed9 post",id:"l\u1ea5y-to\xe0n-b\u1ed9-post",level:4},{value:"Th\xeam b\xe0i vi\u1ebft",id:"th\xeam-b\xe0i-vi\u1ebft",level:4},{value:"Update b\xe0i vi\u1ebft",id:"update-b\xe0i-vi\u1ebft",level:4},{value:"X\xf3a b\xe0i vi\u1ebft",id:"x\xf3a-b\xe0i-vi\u1ebft",level:4}];function l(n){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components},{ToggleTOC:e}=t;return e||function(n,t){throw new Error("Expected "+(t?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("ToggleTOC",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"api-routes",children:"API Routes"})}),"\n",(0,r.jsxs)(t.p,{children:["API Routes trong ",(0,r.jsx)(t.strong,{children:"Next.js"})," l\xe0 c\xe1ch \u0111\u1ec3 b\u1ea1n x\xe2y d\u1ef1ng ",(0,r.jsx)(t.strong,{children:"API backend ngay b\xean trong \u1ee9ng d\u1ee5ng Next.js"})," m\xe0 kh\xf4ng c\u1ea7n server ri\xeang. N\xf3 cho ph\xe9p b\u1ea1n vi\u1ebft c\xe1c endpoint (RESTful ho\u1eb7c custom) tr\u1ef1c ti\u1ebfp trong th\u01b0 m\u1ee5c ",(0,r.jsx)(t.code,{children:"pages/api/"}),"."]}),"\n",(0,r.jsx)(e,{}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"i-restful-api-l\xe0-g\xec",children:"I. RESTful API l\xe0 g\xec?"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"RESTful API"})," l\xe0 m\u1ed9t ti\xeau chu\u1ea9n thi\u1ebft k\u1ebf API d\u1ef1a tr\xean HTTP, trong \u0111\xf3:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"M\u1ed7i URL \u0111\u1ea1i di\u1ec7n cho m\u1ed9t t\xe0i nguy\xean (resource)"}),"\r\nV\xed d\u1ee5: ",(0,r.jsx)(t.code,{children:"/api/posts"}),", ",(0,r.jsx)(t.code,{children:"/api/users"}),", ",(0,r.jsx)(t.code,{children:"/api/products/12"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"M\u1ed7i method HTTP th\u1ec3 hi\u1ec7n h\xe0nh \u0111\u1ed9ng l\xean t\xe0i nguy\xean"})}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Method"}),(0,r.jsx)(t.th,{children:"\xdd ngh\u0129a"}),(0,r.jsx)(t.th,{children:"V\xed d\u1ee5"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"GET"}),(0,r.jsx)(t.td,{children:"L\u1ea5y d\u1eef li\u1ec7u"}),(0,r.jsxs)(t.td,{children:["GET ",(0,r.jsx)(t.code,{children:"/api/posts"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"POST"}),(0,r.jsx)(t.td,{children:"T\u1ea1o m\u1edbi"}),(0,r.jsxs)(t.td,{children:["POST ",(0,r.jsx)(t.code,{children:"/api/posts"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"PUT"}),(0,r.jsx)(t.td,{children:"C\u1eadp nh\u1eadt to\xe0n b\u1ed9"}),(0,r.jsxs)(t.td,{children:["PUT ",(0,r.jsx)(t.code,{children:"/api/posts/3"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"PATCH"}),(0,r.jsx)(t.td,{children:"C\u1eadp nh\u1eadt 1 ph\u1ea7n"}),(0,r.jsxs)(t.td,{children:["PATCH ",(0,r.jsx)(t.code,{children:"/api/posts/3"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"DELETE"}),(0,r.jsx)(t.td,{children:"X\xf3a"}),(0,r.jsxs)(t.td,{children:["DELETE ",(0,r.jsx)(t.code,{children:"/api/posts/3"})]})]})]})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Kh\xf4ng l\u01b0u tr\u1ea1ng th\xe1i (stateless)"}),"\r\nServer kh\xf4ng nh\u1edb ng\u01b0\u1eddi d\xf9ng l\xe0 ai \u2192 m\u1ecdi request g\u1eedi l\xean ph\u1ea3i \u0111\u1ee7 th\xf4ng tin."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Tr\u1ea3 v\u1ec1 JSON chu\u1ea9n h\xf3a"}),"\r\nV\xed d\u1ee5:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "data": {...}\r\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"ii-t\u1ea1i-sao-restful-api-quan-tr\u1ecdng",children:"II. T\u1ea1i sao RESTful API quan tr\u1ecdng?"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Code r\xf5 r\xe0ng v\xe0 th\u1ed1ng nh\u1ea5t"}),"\n",(0,r.jsx)(t.li,{children:"D\u1ec5 scale, d\u1ec5 m\u1edf r\u1ed9ng h\u1ec7 th\u1ed1ng"}),"\n",(0,r.jsx)(t.li,{children:"Frontend (React, Next.js) \u2192 Backend (API) t\xe1ch bi\u1ec7t ho\xe0n to\xe0n"}),"\n",(0,r.jsx)(t.li,{children:"T\u01b0\u01a1ng th\xedch v\u1edbi mobile app, web app, desktop app"}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"iii-\xe1p-d\u1ee5ng-restful-api-trong-nextjs",children:"III. \xc1p d\u1ee5ng RESTful API trong Next.js"}),"\n",(0,r.jsx)(t.p,{children:"Next.js App Router (t\u1eeb v13) h\u1ed7 tr\u1ee3 API d\u1ea1ng:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"src/app/api/posts/route.ts           \u2192 /api/posts\r\nsrc/app/api/posts/[id]/route.ts      \u2192 /api/posts/:id\n"})}),"\n",(0,r.jsxs)(t.p,{children:["V\xe0 m\u1ed7i file ",(0,r.jsx)(t.code,{children:"route.ts"})," ",(0,r.jsx)(t.strong,{children:"t\u1ef1 \u0111\u1ed9ng t\u01b0\u01a1ng \u1ee9ng v\u1edbi REST method"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"export async function GET() {}\r\nexport async function POST() {}\r\nexport async function PUT() {}\r\nexport async function DELETE() {}\r\nexport async function PATCH() {}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["\u2192 Next.js ",(0,r.jsx)(t.strong,{children:"m\u1eb7c \u0111\u1ecbnh \u0111\xe3 h\u1ed7 tr\u1ee3 RESTful architecture"}),"."]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"iv-v\xed-d\u1ee5-restful-api-chu\u1ea9n-trong-nextjs",children:"IV. V\xed d\u1ee5 RESTful API chu\u1ea9n trong Next.js"}),"\n",(0,r.jsx)(t.h4,{id:"1-get-all-posts--apiposts",children:"1. GET all posts \u2192 /api/posts"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"src/app/api/posts/route.ts"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:'import { NextResponse } from "next/server";\r\n\r\nexport async function GET() {\r\n  return NextResponse.json([\r\n    { id: 1, title: "Hello" },\r\n    { id: 2, title: "World" }\r\n  ]);\r\n}\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h4,{id:"2-post-create-new-post--apiposts",children:"2. POST create new post \u2192 /api/posts"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:'export async function POST(req: Request) {\r\n  const data = await req.json();\r\n  return NextResponse.json({\r\n    message: "Created",\r\n    data\r\n  });\r\n}\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h4,{id:"3-get-put-delete-by-id--apipostsid",children:"3. GET, PUT, DELETE by ID \u2192 /api/posts/[id]"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"src/app/api/posts/[id]/route.ts"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:'export async function GET(req, context) {\r\n  const { id } = await context.params;\r\n  return NextResponse.json({ id, title: "Post " + id });\r\n}\r\n\r\nexport async function PUT(req, context) {\r\n  const { id } = await context.params;\r\n  const body = await req.json();\r\n  return NextResponse.json({ message: "Updated", id, body });\r\n}\r\n\r\nexport async function DELETE(req, context) {\r\n  const { id } = await context.params;\r\n  return NextResponse.json({ message: "Deleted", id });\r\n}\n'})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h4,{id:"4-quy-t\u1eafc-\u0111\u1ec3-g\u1ecdi-l\xe0-restful-api-chu\u1ea9n",children:"4. Quy t\u1eafc \u0111\u1ec3 g\u1ecdi l\xe0 RESTful API chu\u1ea9n"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"\u2713 \u0110\u1eb7t t\xean URL theo danh t\u1eeb (resource)"})}),"\n",(0,r.jsx)(t.p,{children:"Kh\xf4ng d\xf9ng \u0111\u1ed9ng t\u1eeb:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"Sai:    /api/getPosts\r\n\u0110\xfang:   /api/posts\n"})}),"\n",(0,r.jsx)(t.h4,{id:"-d\xf9ng-http-method-\u0111\xfang-ngh\u0129a",children:"\u2713 D\xf9ng HTTP method \u0111\xfang ngh\u0129a"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"GET     /api/posts          \u2192 L\u1ea5y danh s\xe1ch\r\nPOST    /api/posts          \u2192 T\u1ea1o m\u1edbi\r\nGET     /api/posts/3        \u2192 L\u1ea5y post 3\r\nPUT     /api/posts/3        \u2192 C\u1eadp nh\u1eadt post 3\r\nDELETE  /api/posts/3        \u2192 X\xf3a post 3\n"})}),"\n",(0,r.jsx)(t.h4,{id:"-tr\u1ea3-json-\u0111\xfang-format",children:"\u2713 Tr\u1ea3 JSON \u0111\xfang format"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'{\r\n  "success": true,\r\n  "data": {...}\r\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"-stateless-kh\xf4ng-l\u01b0u-tr\u1ea1ng-th\xe1i",children:"\u2713 Stateless (kh\xf4ng l\u01b0u tr\u1ea1ng th\xe1i)"}),"\n",(0,r.jsx)(t.p,{children:"Kh\xf4ng session, kh\xf4ng ghi nh\u1edb user \u2192 m\u1ecdi request ph\u1ea3i t\u1ef1 ch\u1ee9a auth/token."}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"v-restful-api-so-v\u1edbi-api-routes-c\u0169",children:"V. RESTful API so v\u1edbi API Routes c\u0169"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"API Routes (pages/api)"}),(0,r.jsx)(t.th,{children:"App Router API (route.ts)"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"D\xf9ng handler default"}),(0,r.jsx)(t.td,{children:"D\xf9ng function theo method"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"\u0110\u1ecbnh ngh\u0129a th\u1ee7 c\xf4ng"}),(0,r.jsx)(t.td,{children:"Next.js t\u1ef1 map REST"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Kh\xf4ng h\u1ed7 tr\u1ee3 Streaming t\u1ed1t"}),(0,r.jsx)(t.td,{children:"H\u1ed7 tr\u1ee3 t\u1ed1t RSC + Edge"})]})]})]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.admonition,{title:"T\xf3m l\u1ea1i",type:"tip",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"RESTful API = quy t\u1eafc x\xe2y d\u1ef1ng API r\xf5 r\xe0ng theo chu\u1ea9n HTTP"}),"\n",(0,r.jsxs)(t.li,{children:["Next.js App Router h\u1ed7 tr\u1ee3 RESTful API ",(0,r.jsx)(t.strong,{children:"m\u1eb7c \u0111\u1ecbnh"})]}),"\n",(0,r.jsx)(t.li,{children:"Ch\u1ec9 c\u1ea7n t\u1ed5 ch\u1ee9c \u0111\xfang route + method l\xe0 b\u1ea1n \u0111\xe3 RESTful"}),"\n"]})}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"ix-th\u1ef1c-h\xe0nh",children:"IX. Th\u1ef1c h\xe0nh"}),"\n",(0,r.jsx)(t.p,{children:"T\u1ea1o RESTful API ho\xe0n ch\u1ec9nh CRUD ch\u1ea1y v\u1edbi JSON file."}),"\n",(0,r.jsx)(t.h3,{id:"1-c\u1ea5u-tr\xfac-th\u01b0-m\u1ee5c-chu\u1ea9n",children:"1. C\u1ea5u tr\xfac th\u01b0 m\u1ee5c chu\u1ea9n"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",metastring:'title="L\xean c\u1ea5u tr\xfac th\u01b0 m\u1ee5c API"',children:"project/\r\n \u251c\u2500\u2500 data/\r\n \u2502    \u2514\u2500\u2500 posts.json\r\n \u2514\u2500\u2500 src/\r\n      \u2514\u2500\u2500 app/\r\n           \u2514\u2500\u2500 api/\r\n                \u2514\u2500\u2500 posts/\r\n                     \u251c\u2500\u2500 route.ts        <-- CRUD cho GET/POST\r\n                     \u2514\u2500\u2500 [id]/\r\n                          \u2514\u2500\u2500 route.ts    <-- CRUD cho GET/PUT/DELETE\r\n\r\n\n"})}),"\n",(0,r.jsx)(t.h3,{id:"2-t\u1ea1o-file-json-datapostsjson",children:"2. T\u1ea1o file JSON (data/posts.json)"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",metastring:'title="T\u1ea1o file t\u1ea1i th\u01b0 m\u1ee5c /data/posts.json"',children:'[\r\n  { "id": 1, "title": "Hello World", "body": "This is a JSON file post" },\r\n  { "id": 2, "title": "Next.js API", "body": "CRUD example using file" }\r\n]\n'})}),"\n",(0,r.jsx)(t.h3,{id:"3-get-t\u1ea5t-c\u1ea3--t\u1ea1o-m\u1edbi",children:"3. GET t\u1ea5t c\u1ea3 + t\u1ea1o m\u1edbi"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",metastring:'title="T\u1ea1o file /api/posts/route.ts"',children:'import { NextResponse } from "next/server";\r\nimport path from "path";\r\nimport { promises as fs } from "fs";\r\n\r\nconst filePath = path.join(process.cwd(), "data/posts.json");\r\n\r\nasync function getPosts() {\r\n  const data = await fs.readFile(filePath, "utf8");\r\n  return JSON.parse(data);\r\n}\r\n\r\nasync function savePosts(posts: any[]) {\r\n  await fs.writeFile(filePath, JSON.stringify(posts, null, 2), "utf8");\r\n}\r\n\r\n// GET /api/posts \u2192 l\u1ea5y to\xe0n b\u1ed9 b\xe0i vi\u1ebft\r\nexport async function GET() {\r\n  const posts = await getPosts();\r\n  return NextResponse.json(posts);\r\n}\r\n\r\n// POST /api/posts \u2192 th\xeam b\xe0i vi\u1ebft\r\nexport async function POST(req: Request) {\r\n  const body = await req.json();\r\n  const posts = await getPosts();\r\n\r\n  const newPost = {\r\n    id: posts.length ? posts[posts.length - 1].id + 1 : 1,\r\n    title: body.title,\r\n    body: body.body,\r\n  };\r\n\r\n  posts.push(newPost);\r\n  await savePosts(posts);\r\n\r\n  return NextResponse.json(newPost, { status: 201 });\r\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"4-get-1-post--update--delete",children:"4. GET 1 post \u2013 UPDATE \u2013 DELETE"}),"\n",(0,r.jsx)(t.p,{children:"\u2714 GET 1 b\xe0i vi\u1ebft\r\n\u2714 PUT \u0111\u1ec3 update\r\n\u2714 DELETE \u0111\u1ec3 x\xf3a"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",metastring:'title="T\u1ea1o file src/app/api/posts/[id]/route.ts"',children:'// Import NextResponse \u0111\u1ec3 tr\u1ea3 JSON trong API route\r\nimport { NextResponse } from "next/server";\r\n\r\n// Import th\u01b0 vi\u1ec7n Node.js \u0111\u1ec3 \u0111\u1ecdc / ghi file\r\nimport fs from "fs";\r\nimport path from "path";\r\n\r\n// T\u1ea1o \u0111\u01b0\u1eddng d\u1eabn tuy\u1ec7t \u0111\u1ed1i \u0111\u1ebfn file JSON (database)\r\nconst DB_PATH = path.join(process.cwd(), "data/posts.json");\r\n\r\n\r\n// H\xe0m \u0111\u1ecdc JSON t\u1eeb file (Sync cho \u0111\u01a1n gi\u1ea3n v\xe0 an to\xe0n)\r\nfunction readDB() {\r\n  const text = fs.readFileSync(DB_PATH, "utf8"); // \u0110\u1ecdc file d\u1ea1ng text\r\n  return JSON.parse(text); // Chuy\u1ec3n text \u2192 object / array\r\n}\r\n\r\n\r\n// H\xe0m ghi d\u1eef li\u1ec7u v\xe0o JSON\r\nfunction writeDB(data: any) {\r\n  fs.writeFileSync(DB_PATH, JSON.stringify(data, null, 2)); // Ghi v\u1edbi format \u0111\u1eb9p\r\n}\r\n\r\n\r\n// Chu\u1ea9n h\xf3a ID: ch\u1ec9 ch\u1ea5p nh\u1eadn s\u1ed1 nguy\xean d\u01b0\u01a1ng\r\nfunction normalizeId(id: any): number | null {\r\n  const n = Number(id);\r\n  return Number.isInteger(n) && n > 0 ? n : null;\r\n}\r\n\r\n\r\n/* ============================\r\n   GET /api/posts/:id\r\n   L\u1ea5y 1 b\xe0i vi\u1ebft theo ID\r\n=============================== */\r\nexport async function GET(\r\n  req: Request,\r\n  context: { params: Promise<{ id: string }> } // \u2b05 params l\xe0 Promise!\r\n) {\r\n  const { id: rawId } = await context.params; // \u2b05 L\u1ea5y ID t\u1eeb URL (b\u1eaft bu\u1ed9c ph\u1ea3i await)\r\n  const id = normalizeId(rawId); // Chu\u1ea9n h\xf3a ID\r\n\r\n  // N\u1ebfu ID kh\xf4ng h\u1ee3p l\u1ec7 \u2192 tr\u1ea3 l\u1ed7i 400\r\n  if (id === null) {\r\n    return NextResponse.json({ message: "Invalid ID" }, { status: 400 });\r\n  }\r\n\r\n  const posts = readDB(); // \u0110\u1ecdc database\r\n  const post = posts.find((p: any) => p.id === id); // T\xecm b\xe0i vi\u1ebft theo ID\r\n\r\n  // Kh\xf4ng c\xf3 b\xe0i vi\u1ebft \u2192 tr\u1ea3 l\u1ed7i 404\r\n  if (!post) {\r\n    return NextResponse.json({ message: "Post not found" }, { status: 404 });\r\n  }\r\n\r\n  return NextResponse.json(post); // Tr\u1ea3 v\u1ec1 b\xe0i vi\u1ebft\r\n}\r\n\r\n\r\n/* ============================\r\n   PUT /api/posts/:id\r\n   Update b\xe0i vi\u1ebft theo ID\r\n=============================== */\r\nexport async function PUT(\r\n  req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  const { id: rawId } = await context.params; // L\u1ea5y ID t\u1eeb URL\r\n  const id = normalizeId(rawId); // Ki\u1ec3m tra ID\r\n\r\n  // ID sai \u2192 b\xe1o l\u1ed7i\r\n  if (id === null) {\r\n    return NextResponse.json({ message: "Invalid ID" }, { status: 400 });\r\n  }\r\n\r\n  const body = await req.json(); // L\u1ea5y d\u1eef li\u1ec7u t\u1eeb client g\u1eedi l\xean\r\n  const posts = readDB(); // \u0110\u1ecdc danh s\xe1ch posts\r\n\r\n  const index = posts.findIndex((p: any) => p.id === id); // T\xecm b\xe0i theo index\r\n\r\n  // N\u1ebfu kh\xf4ng th\u1ea5y \u2192 l\u1ed7i 404\r\n  if (index === -1) {\r\n    return NextResponse.json({ message: "Post not found" }, { status: 404 });\r\n  }\r\n\r\n  // G\u1ed9p d\u1eef li\u1ec7u m\u1edbi v\xe0 c\u0169\r\n  posts[index] = { ...posts[index], ...body };\r\n  writeDB(posts); // Ghi l\u1ea1i database\r\n\r\n  return NextResponse.json(posts[index]); // Tr\u1ea3 post sau khi update\r\n}\r\n\r\n\r\n/* ============================\r\n   DELETE /api/posts/:id\r\n   X\xf3a b\xe0i vi\u1ebft theo ID\r\n=============================== */\r\nexport async function DELETE(\r\n  req: Request,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  const { id: rawId } = await context.params; // L\u1ea5y ID\r\n  const id = normalizeId(rawId); // Validate\r\n\r\n  // ID kh\xf4ng h\u1ee3p l\u1ec7\r\n  if (id === null) {\r\n    return NextResponse.json({ message: "Invalid ID" }, { status: 400 });\r\n  }\r\n\r\n  const posts = readDB(); // \u0110\u1ecdc DB\r\n  const exists = posts.some((p: any) => p.id === id); // Ki\u1ec3m tra t\u1ed3n t\u1ea1i\r\n\r\n  // Kh\xf4ng c\xf3 b\xe0i \u2192 b\xe1o l\u1ed7i\r\n  if (!exists) {\r\n    return NextResponse.json({ message: "Post not found" }, { status: 404 });\r\n  }\r\n\r\n  // L\u1ecdc b\u1ecf b\xe0i vi\u1ebft c\u1ea7n x\xf3a\r\n  const newData = posts.filter((p: any) => p.id !== id);\r\n  writeDB(newData); // Ghi l\u1ea1i database\r\n\r\n  return NextResponse.json({ message: "Deleted successfully" });\r\n}\r\n\n'})}),"\n",(0,r.jsx)(t.h3,{id:"5-c\xe1ch-g\u1ecdi-api-t\u1eeb-component-server-ho\u1eb7c-client",children:"5. C\xe1ch g\u1ecdi API t\u1eeb component (Server ho\u1eb7c Client)"}),"\n",(0,r.jsx)(t.h4,{id:"l\u1ea5y-to\xe0n-b\u1ed9-post",children:"L\u1ea5y to\xe0n b\u1ed9 post"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:'const res = await fetch("http://localhost:3000/api/posts", {\r\n  cache: "no-store",\r\n});\r\nconst posts = await res.json();\n'})}),"\n",(0,r.jsx)(t.h4,{id:"th\xeam-b\xe0i-vi\u1ebft",children:"Th\xeam b\xe0i vi\u1ebft"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:'await fetch("/api/posts", {\r\n  method: "POST",\r\n  body: JSON.stringify({\r\n    title: "New Post",\r\n    body: "Content here...",\r\n  }),\r\n});\r\n\n'})}),"\n",(0,r.jsx)(t.h4,{id:"update-b\xe0i-vi\u1ebft",children:"Update b\xe0i vi\u1ebft"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:'await fetch("/api/posts/3", {\r\n  method: "PUT",\r\n  body: JSON.stringify({\r\n    title: "Updated title",\r\n  }),\r\n});\r\n\n'})}),"\n",(0,r.jsx)(t.h4,{id:"x\xf3a-b\xe0i-vi\u1ebft",children:"X\xf3a b\xe0i vi\u1ebft"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:'await fetch("/api/posts/3", { method: "DELETE" });\n'})})]})}function h(n={}){const{wrapper:t}={...(0,i.R)(),...n.components};return t?(0,r.jsx)(t,{...n,children:(0,r.jsx)(l,{...n})}):l(n)}},8453:(n,t,e)=>{e.d(t,{R:()=>o,x:()=>d});var s=e(6540);const r={},i=s.createContext(r);function o(n){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(t):{...t,...n}},[t,n])}function d(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),s.createElement(i.Provider,{value:t},n.children)}}}]);